{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport findNodeHandle from \"react-native-web/dist/exports/findNodeHandle\";\nimport ReanimatedModule from \"../ReanimatedModule\";\nimport AnimatedNode from \"./AnimatedNode\";\nimport InternalAnimatedValue from \"./AnimatedValue\";\nimport { createAnimatedAlways } from \"./AnimatedAlways\";\nimport invariant from 'fbjs/lib/invariant';\nimport createEventObjectProxyPolyfill from \"./createEventObjectProxyPolyfill\";\n\nfunction sanitizeArgMapping(argMapping) {\n  var eventMappings = [];\n  var alwaysNodes = [];\n\n  var getNode = function getNode(node) {\n    if (Platform.OS === 'web' || Platform.OS === 'windows' || Platform.OS === 'macos') {\n      return node;\n    }\n\n    return node.__nodeID;\n  };\n\n  var traverse = function traverse(value, path) {\n    if (value instanceof InternalAnimatedValue) {\n      eventMappings.push(path.concat(getNode(value)));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(getNode(value.__val)));\n    } else if (typeof value === 'function') {\n      var node = new InternalAnimatedValue(0);\n      alwaysNodes.push(createAnimatedAlways(value(node)));\n      eventMappings.push(path.concat(getNode(node)));\n    } else if (typeof value === 'object') {\n      for (var key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  invariant(argMapping[0] && argMapping[0].nativeEvent, 'Native driven events only support animated values contained inside `nativeEvent`.');\n  var ev = argMapping[0].nativeEvent;\n\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    var proxyHandler = {\n      get: function get(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n\n        return target[name];\n      },\n      set: function set(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n          return true;\n        }\n\n        return false;\n      }\n    };\n    var proxy = typeof Proxy === 'function' ? new Proxy({}, proxyHandler) : createEventObjectProxyPolyfill();\n    alwaysNodes.push(createAnimatedAlways(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return {\n    eventMappings: eventMappings,\n    alwaysNodes: alwaysNodes\n  };\n}\n\nvar AnimatedEvent = function (_AnimatedNode) {\n  _inherits(AnimatedEvent, _AnimatedNode);\n\n  var _super = _createSuper(AnimatedEvent);\n\n  function AnimatedEvent(argMapping) {\n    var _this;\n\n    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, AnimatedEvent);\n\n    var _sanitizeArgMapping = sanitizeArgMapping(argMapping),\n        eventMappings = _sanitizeArgMapping.eventMappings,\n        alwaysNodes = _sanitizeArgMapping.alwaysNodes;\n\n    _this = _super.call(this, {\n      type: 'event',\n      argMapping: eventMappings\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"__isNative\", true);\n\n    _this._alwaysNodes = alwaysNodes;\n    return _this;\n  }\n\n  _createClass(AnimatedEvent, [{\n    key: \"toString\",\n    value: function toString() {\n      return \"AnimatedEvent, id: \".concat(this.__nodeID);\n    }\n  }, {\n    key: \"attachEvent\",\n    value: function attachEvent(viewRef, eventName) {\n      for (var i = 0; i < this._alwaysNodes.length; i++) {\n        this._alwaysNodes[i].__attach();\n      }\n\n      this.__attach();\n\n      var viewTag = findNodeHandle(viewRef);\n      ReanimatedModule.attachEvent(viewTag, eventName, this.__nodeID);\n    }\n  }, {\n    key: \"__onEvaluate\",\n    value: function __onEvaluate() {\n      return 0;\n    }\n  }, {\n    key: \"detachEvent\",\n    value: function detachEvent(viewRef, eventName) {\n      for (var i = 0; i < this._alwaysNodes.length; i++) {\n        this._alwaysNodes[i].isNativelyInitialized() && this._alwaysNodes[i].__detach();\n      }\n\n      var viewTag = findNodeHandle(viewRef);\n      ReanimatedModule.detachEvent(viewTag, eventName, this.__nodeID);\n\n      this.__detach();\n    }\n  }]);\n\n  return AnimatedEvent;\n}(AnimatedNode);\n\nexport { AnimatedEvent as default };\nexport function createAnimatedEvent(argMapping, config) {\n  return new AnimatedEvent(argMapping, config);\n}","map":{"version":3,"mappings":"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","names":["ReanimatedModule","AnimatedNode","InternalAnimatedValue","createAnimatedAlways","invariant","createEventObjectProxyPolyfill","sanitizeArgMapping","argMapping","eventMappings","alwaysNodes","getNode","node","Platform","OS","__nodeID","traverse","value","path","push","concat","__val","key","nativeEvent","ev","proxyHandler","get","target","name","Proxy","set","prop","proxy","AnimatedEvent","constructor","config","type","_defineProperty","_alwaysNodes","toString","attachEvent","viewRef","eventName","i","length","__attach","viewTag","findNodeHandle","__onEvaluate","detachEvent","isNativelyInitialized","__detach","createAnimatedEvent"],"sources":["AnimatedEvent.js"],"sourcesContent":["import { Platform, findNodeHandle } from 'react-native';\nimport ReanimatedModule from '../ReanimatedModule';\n\nimport AnimatedNode from './AnimatedNode';\nimport InternalAnimatedValue from './AnimatedValue';\nimport { createAnimatedAlways } from './AnimatedAlways';\n\nimport invariant from 'fbjs/lib/invariant';\nimport createEventObjectProxyPolyfill from './createEventObjectProxyPolyfill';\n\nfunction sanitizeArgMapping(argMapping) {\n  // Find animated values in `argMapping` and create an array representing their\n  // key path inside the `nativeEvent` object. Ex.: ['contentOffset', 'x'].\n  const eventMappings = [];\n  const alwaysNodes = [];\n\n  const getNode = node => {\n    if (Platform.OS === 'web' || Platform.OS === 'windows' || Platform.OS === 'macos') {\n      return node;\n    }\n    return node.__nodeID;\n  };\n\n  const traverse = (value, path) => {\n    if (value instanceof InternalAnimatedValue) {\n      eventMappings.push(path.concat(getNode(value)));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(getNode(value.__val)));\n    } else if (typeof value === 'function') {\n      const node = new InternalAnimatedValue(0);\n      alwaysNodes.push(createAnimatedAlways(value(node)));\n      eventMappings.push(path.concat(getNode(node)));\n    } else if (typeof value === 'object') {\n      for (const key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  invariant(\n    argMapping[0] && argMapping[0].nativeEvent,\n    'Native driven events only support animated values contained inside `nativeEvent`.'\n  );\n\n  // Assume that the event containing `nativeEvent` is always the first argument.\n  const ev = argMapping[0].nativeEvent;\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    const proxyHandler = {\n      get: function(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n        return target[name];\n      },\n      set: function(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n          return true;\n        }\n        return false;\n      },\n    };\n\n    const proxy =\n      typeof Proxy === 'function'\n        ? new Proxy({}, proxyHandler)\n        : createEventObjectProxyPolyfill();\n    alwaysNodes.push(createAnimatedAlways(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return { eventMappings, alwaysNodes };\n}\n\nexport default class AnimatedEvent extends AnimatedNode {\n  constructor(argMapping, config = {}) {\n    const { eventMappings, alwaysNodes } = sanitizeArgMapping(argMapping);\n    super({ type: 'event', argMapping: eventMappings });\n    this._alwaysNodes = alwaysNodes;\n  }\n\n  toString() {\n    return `AnimatedEvent, id: ${this.__nodeID}`;\n  }\n\n  // The below field is a temporary workaround to make AnimatedEvent object be recognized\n  // as Animated.event event callback and therefore filtered out from being send over the\n  // bridge which was causing the object to be frozen in JS.\n  __isNative = true;\n\n  attachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].__attach();\n    }\n    this.__attach();\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.attachEvent(viewTag, eventName, this.__nodeID);\n  }\n\n  __onEvaluate() {\n    return 0;\n  }\n\n  detachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].isNativelyInitialized() &&\n        this._alwaysNodes[i].__detach();\n    }\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.detachEvent(viewTag, eventName, this.__nodeID);\n    this.__detach();\n  }\n}\n\nexport function createAnimatedEvent(argMapping, config) {\n  return new AnimatedEvent(argMapping, config);\n}\n"]},"metadata":{},"sourceType":"module"}